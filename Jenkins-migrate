pipeline {
  agent any

  environment {
    DOCKER_CONTEXT = "jenkins-remote"
  }

  stages {
    stage('Checkout SQL') {
      steps {
        git branch: 'main', url: 'https://github.com/kitsanaphon1/postgres_BD-latest.git'
      }
    }

    stage('Copy and Run SQL') {
      steps {
        sh '''
          echo "üìÑ Copying init.sql into container..."
          docker --context=$DOCKER_CONTEXT cp ./initdb/init.sql sooyaa-postgres:/tmp/init.sql

          echo "‚ñ∂Ô∏è Running SQL inside PostgreSQL..."
          docker --context=$DOCKER_CONTEXT exec sooyaa-postgres \
            psql -U sooyaa -d sooyaa_db -f /tmp/init.sql
        '''
      }
    }

    stage('Verify') {
      steps {
        sh '''
          docker --context=$DOCKER_CONTEXT exec sooyaa-postgres \
            psql -U sooyaa -d sooyaa_db -c "\\dt"
        '''
      }
    }
  }
}
